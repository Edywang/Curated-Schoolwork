[[extend 'layout.html']]

<div id="vue-target">

  <section class="section">
    <div class="title">Postlandia</div>
  </section>
  
  <section class="section" v-if="page=='add'">
    <div class="">
      <div class="is-fullwidth">
        <div class="field">
          <div class="control">
            <textarea class="textarea is-fullwidth" @input="check_post" v-model="add_post_text" placeholder="Enter new post here"></textarea>
            <p v-if="add_post_empty" class="has-text-danger">Please enter a non-blank value</p>
          </div>
        </div>
        <button class="button is-primary is-size-6" @click="add_post" value="Add">Post</button>
        <button class="button is-warning is-size-6" @click="goto('list')" value="Cancel">Cancel</button>
      </div>
    </div>
  </section>

  <section class="section" v-if="page=='list'">
    <button @click="goto('add')" class="button is-primary">
      <i class="fa fa-plus fa-fw"></i>
  </section>

  <section class="section" v-for="p in posts">
    <div class="tile is-ancestor">
      <div class="tile is-vertical">
        <!-- This div contains each post -->
        <div class="tile is-child notification is-light">
          <div class="">
            <div>{{p.post_text}}</div>
            <div class="is-size-6 has-text-grey">{{p.username}}</div>
          </div>
          <div class="">
            <div class="thumbs is-size-4">
              <span class="has-text-danger is-pulled-right">
                <button v-if="p.user_email === '[[=user_email]]'" @click="delete_post(p._idx)" class="button is-danger"><i class="fa fa-trash fa-fw"></i></button>
              </span>
              <span class="has-text-info">
                <span @mouseover="post_over(p._idx)" @mouseout="post_out(p._idx)">
                  <span @click="set_rating(p.id, 0)">
                    <i class="fa fa-flip-horizontal fa-thumbs-up" v-if="p.myRating == 1"></i>
                  </span>
                  <span @click="set_rating(p.id, 1)">
                    <i class="fa fa-flip-horizontal fa-thumbs-o-up" v-if="p.myRating != 1"></i>
                  </span>
                  <span @click="set_rating(p.id, 0)">
                    <i class="fa fa-thumbs-down" v-if="p.myRating == -1"></i>
                  </span>
                  <span @click="set_rating(p.id, -1)">
                    <i class="fa fa-thumbs-o-down" v-if="p.myRating != -1"></i>
                  </span>
                </span>
              </span>
              <span class="has-text-info" v-if="show==p._idx">
                <span class="is-size-7">{{p.ratings}}</span>
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
</div>

[[block page_scripts]]
<!-- Loads the index-specific js for Vue -->
<script>
  let get_posts_url = "[[=XML(get_posts_url)]]";
  let add_post_url = "[[=XML(add_post_url)]]";
  let delete_post_url = "[[=XML(delete_post_url)]]";
  let rate_post_url = "[[=XML(rate_post_url)]]";
  // Complete with other URLs you need.
  let user_email = "[[=XML(user_email)]]";
  let username = "[[=XML(username)]]";
</script>
<!-- This stuff MUST be done at the end because webpages are rendered as they are received, we must ensure the variables we are using exist before executing our JS -->
<script src="js/index.js"></script>
[[end]]
